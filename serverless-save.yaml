service: cancer-prediction-api
frameworkVersion: '4'

provider:
  name: aws
  runtime: python3.12
  region: eu-west-3
  memorySize: 1024
  timeout: 10
  versionFunctions: true
  httpApi:
    cors:
      allowedOrigins: ["*"]
      allowedHeaders: ["Content-Type"]
      allowedMethods: ["GET", "POST", "OPTIONS"]
  environment:
    S3_BUCKET: mlopstheotiste-bucket         # <-- à adapter
    MODEL_KEY: models/RandomForest.pkl       # <-- à adapter
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - s3:GetObject
          Resource:
            - arn:aws:s3:::${self:provider.environment.S3_BUCKET}/${self:provider.environment.MODEL_KEY}
            # (optionnel, utile si vous changez le nom du fichier)
            - arn:aws:s3:::${self:provider.environment.S3_BUCKET}/models/*

package:
  # on n’embarque que le code nécessaire
  patterns:
    - '!**'                 # exclude everything
    - handler.py            # include only the lambda handler

functions:
  health:
    handler: handler.health
    events:
      - httpApi:
          path: /health
          method: GET

  predict:
    handler: handler.predict
    timeout: 15
    layers:
      # ARNs des layers déjà créés (numpy + scikit-learn)
      - arn:aws:lambda:eu-west-3:571600829584:layer:numpy-layer:2
      - arn:aws:lambda:eu-west-3:571600829584:layer:sklearn-layer:11
    events:
      - httpApi:
          path: /predict
          method: POST
