<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Résultat de la prédiction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --green: #16a34a;
      --red:   #dc2626;
      --bg:    #f5f7fb;
      --card:  #ffffff;
      --text:  #0f172a;
      --muted: #64748b;
    }
    body { margin:0; padding:40px; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { text-align:center; margin-bottom:24px; }
    .card {
      background: var(--card); border-radius: 14px; padding: 28px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.08); text-align: center;
    }
    .badge {
      display: inline-block; padding: 10px 16px; border-radius: 999px;
      font-weight: 600; font-size: 18px;
    }
    .benign  { color:#065f46; background:#d1fae5; border:2px solid var(--green); }
    .malign  { color:#7f1d1d; background:#fee2e2; border:2px solid var(--red); }
    .muted   { color:var(--muted); background:#e2e8f0; border:2px solid #cbd5e1; }
    .details { margin-top:12px; color:var(--muted); font-size:14px; line-height:1.5; }
    .actions { margin-top:24px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .btn { border:none; background:#2563eb; color:#fff; padding:10px 16px; border-radius:10px;
      cursor:pointer; font-size:15px; text-decoration:none; display:inline-block; }
    .btn.secondary { background:#e2e8f0; color:#111827; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Résultat de la prédiction</h1>

    <div class="card">
      <div id="badge" class="badge muted">Analyse en cours…</div>
      <div id="details" class="details"></div>

      <div class="actions">
        <a class="btn" href="/form_validated.html">Revenir au formulaire</a>
        <button class="btn secondary" onclick="window.location.reload()">Rafraîchir</button>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const rawPred  = params.get('prediction');
    const rawProba = params.get('proba');

    function normNum(v){
      if (v == null) return null;
      const n = Number(String(v).replace(',', '.'));
      return Number.isFinite(n) ? n : null;
    }
    function normPred(v){
      const n = normNum(v);
      if (n === 0 || n === 1) return n;
      if (v === '0' || v === '1') return Number(v);
      return null;
    }

    const badge   = document.getElementById('badge');
    const details = document.getElementById('details');

    let pred  = normPred(rawPred);       // 0/1 si possible
    let proba = normNum(rawProba);       // 0..1 ou %
    if (proba !== null) {
      if (proba > 1) proba = proba / 100;         // normaliser un %
      proba = Math.max(0, Math.min(1, proba));    // clamp [0,1]
    }

    // Déterminer l'étiquette à afficher
    let label;
    if (pred === 0 || pred === 1) {
      label = pred;
    } else if (proba !== null) {
      label = proba >= 0.5 ? 1 : 0; // seuil 0.5
    }

    function setBadge(lab){
      if (lab === 0) {
        badge.textContent = 'Tumeur bénigne (0)';
        badge.className = 'badge benign';
      } else if (lab === 1) {
        badge.textContent = 'Tumeur maligne (1)';
        badge.className = 'badge malign';
      } else {
        badge.textContent = 'Erreur : prédiction non trouvée.';
        badge.className = 'badge muted';
      }
    }

    // Affichage
    setBadge(label);

    const lines = [];
    if (rawPred != null)  lines.push('Valeur reçue (prediction) : ' + rawPred);
    if (proba != null)    lines.push('Probabilité (classe 1) : ' + (proba*100).toFixed(1) + ' %');
    if (!lines.length)    lines.push('Assurez-vous que l’URL contient ?prediction=... (et éventuellement &proba=...).');
    details.innerHTML = lines.map(l => `<div>${l}</div>`).join('');
  </script>
</body>
</html>
